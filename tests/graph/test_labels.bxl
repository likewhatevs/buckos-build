"""
BXL graph structure test: target label assignment.

Contains two entry points:
- test_labels: per-package label spot checks on known targets
- test_label_coverage: full-universe label counts, coverage, and format invariants

Run:
    buck2 bxl buckos//tests/graph/test_labels.bxl:test_labels
    buck2 bxl buckos//tests/graph/test_labels.bxl:test_label_coverage
"""

load("//tests/graph:test_labels_impl.bzl", "run", "run_coverage")

def _impl(ctx):
    passed, failed, details = run(ctx)
    if failed > 0:
        fail("{} assertion(s) failed\n{}".format(failed, details))

def _coverage_impl(ctx):
    passed, failed, details = run_coverage(ctx)
    if failed > 0:
        fail("{} assertion(s) failed\n{}".format(failed, details))

test_labels = bxl_main(
    doc = "Verify buckos:compile and buckos:build:* labels on migrated packages.",
    impl = _impl,
    cli_args = {},
)

test_label_coverage = bxl_main(
    doc = "Verify label category counts, coverage ratios, and format invariants.",
    impl = _coverage_impl,
    cli_args = {},
)

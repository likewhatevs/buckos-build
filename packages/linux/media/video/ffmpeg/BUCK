load("@root//defs:package_defs.bzl", "autotools_package")

# FFmpeg - Complete, cross-platform solution to record, convert and stream audio and video

autotools_package(
    name = "ffmpeg",
    version = "7.1",
    src_uri = "https://ffmpeg.org/releases/ffmpeg-7.1.tar.xz",
    sha256 = "40973d44970dbc83ef302b0609f2e74982be2d85916dd2ee7472d30678a7abe6",
    description = "Complete, cross-platform solution to record, convert and stream audio and video",
    homepage = "https://ffmpeg.org/",
    license = "LGPL-3.0",
    iuse = ["shared", "static", "gpl", "nonfree", "x264", "x265", "vpx", "aom", "dav1d", "theora", "vorbis", "opus", "mp3lame", "openssl", "gnutls"],
    use_defaults = ["shared", "gpl"],
    deps = [
        "//packages/linux/system/libs/zlib:zlib",
    ],
    use_deps = {
        "x264": ["//packages/linux/media/video/x264:x264"],
        "x265": ["//packages/linux/media/video/x265:x265"],
        "vpx": ["//packages/linux/media/video/libvpx:libvpx"],
        "aom": ["//packages/linux/media/video/libaom:libaom"],
        "dav1d": ["//packages/linux/media/video/dav1d:dav1d"],
        "theora": ["//packages/linux/media/video/theora:theora"],
        "vorbis": ["//packages/linux/media/audio/vorbis:vorbis"],
        "opus": ["//packages/linux/media/audio/opus:opus"],
        "mp3lame": ["//packages/linux/media/audio/lame:lame"],
        "openssl": ["//packages/linux/system/libs/crypto/openssl:openssl"],
        "gnutls": ["//packages/linux/network/tls/gnutls:gnutls"],
    },
    configure_args = [
        "--prefix=${PREFIX}",
        "--enable-pic",
        "--disable-debug",
        "--disable-stripping",
    ],
    use_configure = {
        "shared": "--enable-shared",
        "-shared": "--disable-shared",
        "static": "--enable-static",
        "-static": "--disable-static",
        "gpl": "--enable-gpl",
        "nonfree": "--enable-nonfree",
        "x264": "--enable-libx264",
        "x265": "--enable-libx265",
        "vpx": "--enable-libvpx",
        "aom": "--enable-libaom",
        "dav1d": "--enable-libdav1d",
        "theora": "--enable-libtheora",
        "vorbis": "--enable-libvorbis",
        "opus": "--enable-libopus",
        "mp3lame": "--enable-libmp3lame",
        "openssl": "--enable-openssl",
        "gnutls": "--enable-gnutls",
    },
    visibility = ["PUBLIC"],
)

load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "nvidia-l4t-jetson-multimedia-api",
    version = "6.2",
    local_only = True,
    filename = "nvidia-l4t-jetson-multimedia-api_6.2_arm64.deb",
    description = "NVIDIA Jetson Multimedia API for video encode/decode and image processing",
    homepage = "https://developer.nvidia.com/embedded/jetson-linux",
    license = "NVIDIA-Proprietary",
    install_script = """
        mkdir -p extract
        cd extract
        ar x $SRCS/*.deb
        if [ -f data.tar.zst ]; then
            tar --zstd -xf data.tar.zst
        elif [ -f data.tar.xz ]; then
            tar xf data.tar.xz
        elif [ -f data.tar.gz ]; then
            tar xzf data.tar.gz
        fi

        mkdir -p "$OUT/usr/include"
        mkdir -p "$OUT/usr/src"
        mkdir -p "$OUT/usr/share"

        if [ -d usr/src/jetson_multimedia_api ]; then
            cp -r usr/src/jetson_multimedia_api "$OUT/usr/src/"
        fi

        if [ -d usr/share/doc ]; then
            cp -r usr/share/doc "$OUT/usr/share/"
        fi
    """,
    visibility = ["PUBLIC"],
    labels = ["buckos:hw:cuda"],
)

# =============================================================================
# LAME - High quality MP3 encoder
# =============================================================================
#
# LAME is a high quality MPEG Audio Layer III (MP3) encoder licensed under the LGPL.
# LAME is considered the best MP3 encoder at mid-high bitrates and at VBR, mostly
# thanks to the dedicated work of its developers and the open source licensing model
# that allowed the project to tap into engineering resources from all around the world.
#
# Key features:
# - High quality MP3 encoding
# - Constant bitrate (CBR) and variable bitrate (VBR) encoding
# - ABR (average bitrate) encoding mode
# - Multiple encoding quality levels (from fast to best quality)
# - Psychoacoustic modeling for better sound quality
# - Joint stereo encoding
# - ReplayGain analysis
# - ID3 tag support
# - MP3 decoding capability
#
# LAME development started in 1998. LAME is licensed under the LGPL.
# LAME is one of the most advanced MP3 encoders, featuring:
# - Variable Bitrate (VBR) encoding
# - ABR (Average Bitrate) mode
# - CBR (Constant Bitrate) mode
# - Psychoacoustic algorithms
# - Noise shaping
# - Improved stereo encoding
#
# =============================================================================

load("@root//defs:package_defs.bzl", "autotools_package")
load("@root//defs:use_flags.bzl", "set_use_flags")

autotools_package(
    name = "lame",
    # SourceForge release tarball includes pre-generated configure script
    bdepend = [],
    src_prepare = "",
    version = "3.100",
    src_uri = "https://downloads.sourceforge.net/project/lame/lame/3.100/lame-3.100.tar.gz",
    sha256 = "ddfe36cab873794038ae2c1210557ad34857a4b6bdc515785d1da9e175b1da1e",
    signature_required = False,
    description = "High quality MPEG Audio Layer III (MP3) encoder",
    homepage = "https://lame.sourceforge.io/",
    license = "LGPL-2.0-or-later",
    iuse = [
        "analyzer",
        "cpu_flags_x86_mmx",
        "debug",
        "decoder",
        "frontend",
        "mp3rtp",
        "sndfile",
        "static-libs",
    ],
    use_defaults = ["frontend", "decoder"],
    configure_args = [
        "--prefix=/usr",
        "--disable-static",
        "--enable-shared",
        "--enable-nasm",
    ],
    use_configure = {
        "-analyzer": "--disable-analyzer-hooks",
        "-cpu_flags_x86_mmx": "--disable-cpu_flags_x86_mmx",
        "-debug": "--disable-debug",
        "-decoder": "--disable-decoder",
        "-frontend": "--disable-mp3rtp",
        "-mp3rtp": "--disable-mp3rtp",
        "-sndfile": "--disable-sndfile",
        "-static-libs": "--disable-static",
        "analyzer": "--enable-analyzer-hooks",
        "cpu_flags_x86_mmx": "--enable-cpu_flags_x86_mmx",
        "debug": "--enable-debug",
        "decoder": "--enable-decoder",
        "frontend": "--enable-mp3rtp",
        "mp3rtp": "--enable-mp3rtp",
        "sndfile": "--enable-sndfile",
        "static-libs": "--enable-static",
    },
    deps = [],
    visibility = ["PUBLIC"],
)

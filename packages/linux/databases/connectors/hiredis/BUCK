load("//defs:package.bzl", "package")

# hiredis - Minimalistic C client for Redis
#
# Hiredis is a minimalistic C client library for the Redis database.
# It's small, portable, and supports both synchronous and asynchronous
# operations. The library provides a low-level API for Redis commands
# and supports the Redis protocol (RESP).
#
# USE flags:
#   ssl       - Enable SSL/TLS support
#   examples  - Build example programs
#   static    - Build static library

package(
    build_rule = "cmake",
    name = "hiredis",
    version = "1.2.0",
    url = "https://github.com/redis/hiredis/archive/refs/tags/v1.2.0.tar.gz",
    sha256 = "82ad632d31ee05da13b537c124f819eb88e18851d9cb0c30ae0552084811588c",
    description = "Minimalistic C client library for Redis",
    homepage = "https://github.com/redis/hiredis",
    license = "BSD-3-Clause",

    # USE flags this package supports

    # Default enabled flags

    # Conditional dependencies based on USE flags
    use_deps = {
        "ssl": "//packages/linux/system/libs/crypto/openssl:openssl",
    },

    # Base CMake arguments (always applied)
    configure_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DENABLE_SSL=ON",
        "-DDISABLE_TESTS=ON",
    ],

    # CMake options based on USE flags
    use_configure = {
        "examples": ("-DENABLE_EXAMPLES=ON", "-DENABLE_EXAMPLES=OFF"),
        "ssl": ("-DENABLE_SSL=ON", "-DENABLE_SSL=OFF"),
        "static": ("-DBUILD_SHARED_LIBS=OFF", "-DBUILD_SHARED_LIBS=ON"),
    },

    # Base dependencies (always required)
    deps = [],

)

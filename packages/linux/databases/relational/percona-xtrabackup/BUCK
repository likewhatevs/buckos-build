load("//defs:package_defs.bzl", "cmake_package")

# Percona XtraBackup - Open source hot backup utility for MySQL
#
# Percona XtraBackup is an open-source hot backup utility for MySQL that
# doesn't lock your database during the backup. It works with MySQL, MariaDB,
# and Percona Server for MySQL databases.
#
# USE flags:
#   ssl       - Enable SSL/TLS support
#   zstd      - Enable Zstandard compression support

cmake_package(
    name = "percona-xtrabackup",
    version = "8.0.35-31",
    src_uri = "https://github.com/percona/percona-xtrabackup/archive/refs/tags/percona-xtrabackup-8.0.35-31.tar.gz",
    sha256 = "5ecd6ca5152913c7f5f605065943dc0706be6a7f66c7a935ceac3fe64a7b7560",
    description = "Open source hot backup utility for MySQL-based servers",
    homepage = "https://www.percona.com/software/mysql-database/percona-xtrabackup",
    license = "GPL-2.0",
    iuse = ["ssl", "zstd"],
    use_defaults = ["ssl", "zstd"],
    deps = [
        "//packages/linux/databases/mysql:mysql",
        "//packages/linux/dev-libs/misc/libaio:libaio",
        "//packages/linux/system/libs/utility/libevent:libevent",
        "//packages/linux/core/zlib:zlib",
        "//packages/linux/dev-libs/compression/lz4:lz4",
    ],
    use_deps = {
        "ssl": ["//packages/linux/system/libs/crypto/openssl:openssl"],
        "zstd": ["//packages/linux/system/libs/compression/zstd:zstd"],
    },
    cmake_args = [
        "-DBUILD_CONFIG=xtrabackup_release",
        "-DWITH_BOOST=/usr/include",
        "-DDOWNLOAD_BOOST=0",
    ],
    visibility = ["PUBLIC"],
)

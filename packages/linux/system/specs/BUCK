# BuckOS Specifications Package
#
# This package installs all BuckOS formal specifications to /etc/buckos/specs
# for use by package managers, installers, and AI-assisted tools.

# Generate the specification package
genrule(
    name = "buckos-specs-gen",
    out = "buckos-specs",
    cmd = """
# Create directory structure
mkdir -p $OUT/etc/buckos/specs/core
mkdir -p $OUT/etc/buckos/specs/bootstrap
mkdir -p $OUT/etc/buckos/specs/integration
mkdir -p $OUT/etc/buckos/specs/features
mkdir -p $OUT/etc/buckos/specs/tooling

# Copy spec files - specs-files location may be a list of files
for f in $(location //specs:specs-files); do
    if [ -f "$$f" ]; then
        # Copy to core by default
        cp "$$f" "$OUT/etc/buckos/specs/core/" 2>/dev/null || true
    fi
done

# Copy index and registry
cp $(location //specs:index) $OUT/etc/buckos/specs/INDEX.md 2>/dev/null || true
cp $(location //specs:registry) $OUT/etc/buckos/specs/REGISTRY.json 2>/dev/null || true

# Copy README and template
cp $(location //specs:readme) $OUT/etc/buckos/specs/README.md 2>/dev/null || true
cp $(location //specs:template) $OUT/etc/buckos/specs/TEMPLATE.md 2>/dev/null || true

# Set proper permissions
find $OUT/etc/buckos/specs -type f -exec chmod 644 {} \\;
find $OUT/etc/buckos/specs -type d -exec chmod 755 {} \\;
    """,
    srcs = [
        "//specs:specs-files",
        "//specs:index",
        "//specs:registry",
        "//specs:readme",
        "//specs:template",
    ],
    visibility = ["PUBLIC"],
)

# Wrap in filegroup for use in rootfs
filegroup(
    name = "buckos-specs",
    srcs = [":buckos-specs-gen"],
    default_target_platform = "//platforms:linux-target",
    visibility = ["PUBLIC"],
)

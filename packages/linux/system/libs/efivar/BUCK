load("@root//defs:package_defs.bzl", "download_source", "autotools_package")
load("@root//defs:use_flags.bzl", "set_use_flags")

# efivar - Tools and library for manipulating EFI variables
download_source(
    name = "efivar-src",
    src_uri = "https://github.com/rhboot/efivar/archive/refs/tags/39.tar.gz",
    sha256 = "c9edd15f2eeeea63232f3e669a48e992c7be9aff57ee22672ac31f5eca1609a6",
    signature_required = False,
)

autotools_package(
    name = "efivar",
    source = ":efivar-src",
    version = "39",
    description = "Tools and library for manipulating EFI variables",
    homepage = "https://github.com/rhboot/efivar",
    license = "LGPL-2.1",
    src_configure = """
echo "efivar uses Make, skipping configure"
""",
    src_compile = """
# Build only the libraries and binaries, skip docs (requires mandoc)
make -j${MAKEOPTS:-$(nproc)} PREFIX=/usr LIBDIR=/usr/lib64 HOST_MARCH= ERRORS= -C src
""",
    src_install = """
# Install only the libraries and binaries
make DESTDIR=$DESTDIR PREFIX=/usr LIBDIR=/usr/lib64 -C src install
# Install headers
make DESTDIR=$DESTDIR PREFIX=/usr LIBDIR=/usr/lib64 -C src install-headers
""",
    deps = [
        "system//libs/ipc/popt:popt",
    ],
    visibility = ["PUBLIC"],
)

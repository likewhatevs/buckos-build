load("@root//defs:package_defs.bzl", "download_source", "autotools_package")
load("@root//defs:use_flags.bzl", "set_use_flags")

autotools_package(
    name = "sdl2-image",
    version = "2.8.2",
    src_uri = "https://github.com/libsdl-org/SDL_image/releases/download/release-2.8.2/SDL2_image-2.8.2.tar.gz",
    sha256 = "8f486bbfbcf8464dd58c9e5d93394ab0255ce68b51c5a966a918244820a76ddc",
    signature_required = False,
    description = "SDL2 image loading library",
    homepage = "https://www.libsdl.org/projects/SDL_image/",
    license = "Zlib",
    iuse = [
        "avif",
        "gif",
        "jpeg",
        "jpegxl",
        "png",
        "samples",
        "static-libs",
        "tiff",
        "webp",
    ],
    use_defaults = ["png", "jpeg"],
    use_configure = {
        "-avif": "-DSDL2IMAGE_AVIF=OFF",
        "-gif": "--without-gif",
        "-jpeg": "-DSDL2IMAGE_JPG=OFF",
        "-jpegxl": "--disable-jpegxl",
        "-png": "-DSDL2IMAGE_PNG=OFF",
        "-samples": "--disable-samples",
        "-static-libs": "-DBUILD_SHARED_LIBS=ON",
        "-tiff": "-DSDL2IMAGE_TIF=OFF",
        "-webp": "-DSDL2IMAGE_WEBP=OFF",
        "avif": "-DSDL2IMAGE_AVIF=ON",
        "gif": "--with-gif",
        "jpeg": "-DSDL2IMAGE_JPG=ON",
        "jpegxl": "--enable-jpegxl",
        "png": "-DSDL2IMAGE_PNG=ON",
        "samples": "--enable-samples",
        "static-libs": "-DBUILD_SHARED_LIBS=OFF",
        "tiff": "-DSDL2IMAGE_TIF=ON",
        "webp": "-DSDL2IMAGE_WEBP=ON",
    },
    use_deps = {
        "png": ["//packages/linux/system/libs/image/libpng:libpng"],
        "jpeg": ["//packages/linux/system/libs/image/libjpeg-turbo:libjpeg-turbo"],
        "webp": ["//packages/linux/system/libs/image/libwebp:libwebp"],
        "tiff": ["//packages/linux/system/libs/image/libtiff:libtiff"],
    },
    configure_args = [],
    pre_configure = """
mkdir -p build
cd build
# USE flags: png, jpeg, webp, tiff, avif, static-libs
cmake .. -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release \
    $CONFIGURE_ARGS
""",
    deps = [
        "//packages/linux/system/libs/multimedia/sdl2:sdl2",
    ],
    visibility = ["PUBLIC"],
)

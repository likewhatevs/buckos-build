load("//defs:package.bzl", "package")

# cryptsetup - Disk encryption setup utility
# USE flags: openssl, gcrypt, nettle, nls, argon2, ssh-token, fips

package(
    build_rule = "autotools",
    name = "popt",
    pre_configure_cmds = ["""
autoreconf -fi
"""],
    version = "1.19",
    url = "http://ftp.rpm.org/popt/releases/popt-1.x/popt-1.19.tar.gz",
    sha256 = "c25a4838fc8e4c1c8aacb8bd620edb3084a3d63bf8987fdad3ca2758c63240f9",
    description = "Command line option parsing library",
    homepage = "http://ftp.rpm.org/popt/",
    license = "MIT",
    use_configure = {
        "nls": ("--enable-nls", "--disable-nls"),
        "static-libs": ("--enable-static", "--disable-static"),
    },
    configure_args = [
        "--prefix=/usr",
        "--enable-shared",
    ],
    visibility = ["PUBLIC"],
)

package(
    build_rule = "autotools",
    name = "lvm2",
    # Use pre-generated configure from tarball to avoid AX_PYTHON_MODULE macro issues
    # Add library search paths for cross-compilation via LDFLAGS -L flags
    # LVM2's Makefile uses CLDFLAGS (configure-time LDFLAGS), not make-time LDFLAGS
    # CLDFLAGS is now exported by ebuild.sh alongside LDFLAGS
    version = "2.03.23",
    url = "https://mirrors.kernel.org/sourceware/lvm2/LVM2.2.03.23.tgz",
    sha256 = "74e794a9e9dee1bcf8a2065f65b9196c44fdf321e22d63b98ed7de8c9aa17a5d",
    description = "Logical Volume Manager 2 utilities",
    homepage = "https://sourceware.org/lvm2/",
    license = "GPL-2.0",
    # USE flags: systemd - use systemd's libudev instead of eudev
# Default to systemd for modern systems
    use_deps = {
        "systemd": ("//packages/linux/system/init/systemd:systemd", "//packages/linux/system/init/eudev:eudev"),
    },
    deps = [
        "//packages/linux/system/libs/io/libaio:libaio",
                "//packages/linux/system/libs/ipc/libcap:libcap",
                # Required by libsystemd,
                "//packages/linux/dev-tools/build-systems/autoconf:autoconf",
                "//packages/linux/dev-tools/build-systems/automake:automake",
                "//packages/linux/dev-tools/build-systems/libtool:libtool",
                "//packages/linux/dev-libs/misc/gettext:gettext",
                "//packages/linux/dev-tools/build-systems/autoconf:autoconf",
                "//packages/linux/dev-tools/build-systems/automake:automake",
                "//packages/linux/dev-tools/build-systems/libtool:libtool",
                "//packages/linux/dev-tools/build-systems/pkg-config:pkg-config",
                # For PKG_* m4 macros
        "//packages/linux/dev-libs/misc/gettext:gettext"
    ],
    visibility = ["PUBLIC"],
)

# cryptsetup package moved to //packages/linux/system/filesystem/management/cryptsetup

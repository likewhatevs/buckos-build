load("//defs:package.bzl", "package")

# readline - GNU Readline library for command line editing
# Uses traditional autotools (configure/make), not cmake

package(
    build_rule = "autotools",
    name = "readline",
    version = "8.3",
    url = "https://ftp.gnu.org/gnu/readline/readline-8.3.tar.gz",
    sha256 = "fe5383204467828cd495ee8d1d3c037a7eba1389c22bc6a041f627976f9061cc",
    description = "GNU Readline library for command line editing",
    homepage = "https://tiswww.case.edu/php/chet/readline/rltop.html",
    license = "GPL-3.0-or-later",

    use_configure = {
        "static-libs": ("--enable-static", "--disable-static"),
        "unicode": ("--enable-multibyte", "--disable-multibyte"),
    },

    configure_args = [
        "--enable-shared",
        "--with-curses",
    ],
    # readline's configure finds ncurses but doesn't propagate it to SHLIB_LIBS,
    # so the shared library lacks DT_NEEDED for ncursesw â€” consumers get
    # undefined termcap symbols (tgetent, tputs, etc.) at link time.
    make_args = ["SHLIB_LIBS=-lncursesw"],
    deps = ["//packages/linux/system/terminal/ncurses:ncurses"],
    visibility = ["PUBLIC"],
)

load("@root//defs:package_defs.bzl", "meson_package")

meson_package(
    name = "scx-backports",
    version = "main",
    src_uri = "https://github.com/sched-ext/scx-backports/archive/refs/heads/main.tar.gz",
    sha256 = "1e0fb6c8f6d58544b85827e417b29d5768812119a8c92f0781ab38e5f1ed99eb",
    meson_args = [
        "-Denable_rust=false",
        "-Denable_stress=false",
        "-Dsystemd=disabled",
        "-Dopenrc=disabled",
        "-Dlibalpm=disabled",
        "-Doffline=true",
    ],
    deps = [
        "//packages/linux/dev-tools/compilers/llvm:llvm",
        "//packages/linux/system/libs/bpf/libbpf:libbpf",
        "//packages/linux/system/libs/bpf/bpftool:bpftool",
        "//packages/linux/system/libs/elfutils:elfutils",
        "//packages/linux/dev-libs/compression/zlib:zlib",
        "//packages/linux/dev-libs/compression/zstd:zstd",
        "//packages/linux/system/security/libseccomp:libseccomp",
        "//packages/linux/dev-tools/parsers/jq:jq",
    ],
    iuse = ["rust", "systemd"],
    use_defaults = [],
    use_options = {
        "rust": "enable_rust",
        "systemd": "systemd",
    },
    use_deps = {
        "systemd": ["//packages/linux/system/init/systemd:systemd"],
    },
)

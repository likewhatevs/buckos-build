load("//defs:package_defs.bzl", "cmake_package")

cmake_package(
    name = "dnf5",
    version = "5.4.0.0",
    src_uri = "https://github.com/rpm-software-management/dnf5/archive/refs/tags/5.4.0.0.tar.gz",
    sha256 = "9e8ed27088daaaaf9e76120a06cb320e2d6b5c50e75762facf2e5227d946e063",
    deps = [
        "//packages/linux/system/pkg-mgmt/libsolv:libsolv",
        "//packages/linux/system/pkg-mgmt/librepo:librepo",
        "//packages/linux/system/pkg-mgmt/rpm:rpm",
        "//packages/linux/system/libs/data/json-c:json-c",
        "//packages/linux/system/libs/database/sqlite:sqlite",
        "//packages/linux/system/libs/crypto/gpgme:gpgme",
        "//packages/linux/core/glib:glib",
        "//packages/linux/dev-libs/misc/toml11:toml11",
        "//packages/linux/dev-libs/misc/fmt:fmt",
        "//packages/linux/system/libs/data/libxml2:libxml2",
        "//packages/linux/core/util-linux:util-linux",
        # Transitive deps needed for pkg-config resolution
        "//packages/linux/core/zlib:zlib",
        "//packages/linux/system/libs/utility/pcre2:pcre2",
        "//packages/linux/system/libs/utility/libffi:libffi",
        "//packages/linux/system/libs/crypto/openssl:openssl",
        "//packages/linux/system/libs/crypto/libgpg-error:libgpg-error",
        "//packages/linux/system/security/gnupg:libassuan",
        "//packages/linux/dev-libs/popt:popt",
        "//packages/linux/system/libs/network/curl:curl",
        "//packages/linux/system/libs/compression/bzip2:bzip2",
        "//packages/linux/system/libs/compression/zstd:zstd",
        "//packages/linux/system/libs/compression/xz:xz",
    ],
    cmake_args = [
        "-DWITH_DNF5DAEMON_CLIENT=OFF",
        "-DWITH_DNF5DAEMON_SERVER=OFF",
        "-DWITH_TESTS=OFF",
        "-DWITH_PERL5=OFF",
        "-DWITH_PYTHON3=OFF",
        "-DWITH_RUBY=OFF",
        "-DWITH_MAN=OFF",
        "-DWITH_HTML=OFF",
        "-DWITH_TRANSLATIONS=OFF",
        "-DWITH_ACL=OFF",
        "-DWITH_MODULEMD=OFF",
        "-DWITH_SYSTEMD=OFF",
        "-DWITH_DNF5_PLUGINS=OFF",
        "-DWITH_PLUGIN_ACTIONS=OFF",
        "-DWITH_PLUGIN_APPSTREAM=OFF",
        "-DWITH_PLUGIN_RHSM=OFF",
        "-DWITH_PLUGIN_MANIFEST=OFF",
        "-DWITH_PLUGIN_EXPIRED_PGP_KEYS=OFF",
        "-DWITH_PLUGIN_LOCAL=OFF",
        "-DWITH_PYTHON_PLUGINS_LOADER=OFF",
        "-DWITH_GO=OFF",
    ],
    description = "Package manager forked from DNF, using libdnf5",
    homepage = "https://github.com/rpm-software-management/dnf5",
    license = "GPL-2.0",
    visibility = ["PUBLIC"],
)

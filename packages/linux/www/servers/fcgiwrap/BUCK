load("@root//defs:package_defs.bzl", "autotools_package")

# fcgiwrap - Simple FastCGI wrapper for CGI scripts
#
# fcgiwrap is a simple server for running CGI applications over FastCGI.
# It works great with nginx and other web servers that support FastCGI.
#
# It's especially useful for hosting legacy CGI scripts or git repositories
# over HTTP.

autotools_package(
    name = "fcgiwrap",
    # Disable -Werror for implicit-fallthrough warning
    env = {"CFLAGS": "-O2 -Wno-implicit-fallthrough"},
    bdepend = [
        "dev-tools//build-systems/autoconf:autoconf",
        "dev-tools//build-systems/automake:automake",
        "dev-tools//build-systems/libtool:libtool",
        "dev-tools//build-systems/pkg-config:pkg-config",
    ],
    src_prepare = """
autoreconf -fiv
""",
    version = "1.1.0",
    iuse = ["systemd"],
    use_configure = {
        "-systemd": "--without-systemd",
        "systemd": "--with-systemd",
    },
    use_deps = {
        "systemd": ["system//init/systemd:systemd"],
    },
    src_uri = "https://github.com/gnosek/fcgiwrap/archive/refs/tags/1.1.0.tar.gz",
    sha256 = "4c7de0db2634c38297d5fcef61ab4a3e21856dd7247d49c33d9b19542bd1c61f",
    description = "Simple FastCGI wrapper for CGI scripts",
    homepage = "https://github.com/gnosek/fcgiwrap",
    license = "MIT",
    deps = [
        "www//servers/fcgi:fcgi",
    ],
    configure_args = [
        "--prefix=${PREFIX}",
    ],
    visibility = ["PUBLIC"],
)

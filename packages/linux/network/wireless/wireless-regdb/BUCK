load("//defs:package_defs.bzl","download_source", "make_package")

# wireless-regdb contains pre-built regulatory.db files
# We skip the build phase and just install the pre-built files
make_package(
    name = "wireless-regdb",
    version = "2024.01.23",
    src_uri = "https://www.kernel.org/pub/software/network/wireless-regdb/wireless-regdb-2024.01.23.tar.xz",
    sha256 = "c8a61c9acf76fa7eb4239e89f640dee3e87098d9f69b4d3518c9c60fc6d20c55",
    signature_required = False,

    iuse = [],
    use_defaults = [],

    # Skip build - the tarball already contains pre-built regulatory.db files
    src_compile = """
echo "Using pre-built regulatory database files from tarball"
""",

    post_install = """
install -d "$DESTDIR/usr/lib/crda"
install -d "$DESTDIR/lib/firmware"
# Install pre-built files from tarball
install -m 644 regulatory.db "$DESTDIR/lib/firmware/"
install -m 644 regulatory.db.p7s "$DESTDIR/lib/firmware/"
# Also install to /usr/lib/firmware for systemd compatibility
install -d "$DESTDIR/usr/lib/firmware"
install -m 644 regulatory.db "$DESTDIR/usr/lib/firmware/"
install -m 644 regulatory.db.p7s "$DESTDIR/usr/lib/firmware/"
""",

    labels = ["buckos:firmware"],
    description = "Wireless regulatory database for Linux",
    homepage = "https://wireless.wiki.kernel.org/en/developers/regulatory/wireless-regdb",
    license = "ISC",
    visibility = ["PUBLIC"],
)

load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "dnscrypt-proxy",
    version = "2.1.5",
    url = "https://github.com/DNSCrypt/dnscrypt-proxy/archive/refs/tags/2.1.5.tar.gz",
    sha256 = "044c4db9a3c7bdcf886ff8f83c4b137d2fd37a65477a92bfe86bf69587ea7355",
    description = "Flexible DNS proxy with encrypted DNS protocols support",
    homepage = "https://dnscrypt.info/",
    license = "ISC",
    install_script = """
cd $SRCS
install -Dm755 dnscrypt-proxy "$OUT/usr/bin/dnscrypt-proxy"

# Install default configuration
mkdir -p "$OUT/etc/dnscrypt-proxy"
if [ -f example-dnscrypt-proxy.toml ]; then
    install -Dm644 example-dnscrypt-proxy.toml "$OUT/etc/dnscrypt-proxy/dnscrypt-proxy.toml"
fi

# Install blocklist and other example files
for f in *.txt *.md; do
    if [ -f "$f" ]; then
        install -Dm644 "$f" "$OUT/usr/share/dnscrypt-proxy/$f"
    fi
done
""",
    deps = [],
)

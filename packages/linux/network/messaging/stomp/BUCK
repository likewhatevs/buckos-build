load("@root//defs:package_defs.bzl", "simple_package")

# STOMP - Streaming Protocol for Message-Oriented Middleware
#
# STOMP (Simple Text Oriented Messaging Protocol) is a simple text-based
# protocol designed for working with message-oriented middleware. It provides
# an interoperable wire format that allows clients to talk to any message
# broker supporting the protocol.
#
# This is a C implementation of the STOMP protocol.

simple_package(
    name = "stomp",
    version = "1.0.0",
    src_uri = "https://github.com/IBM/stomp/archive/refs/heads/meta.tar.gz",
    sha256 = "d2e80762e11b32bd4ac628941dd2bcf4e00729beab2497f36f637a5125662cc9",
    description = "C library implementing the STOMP messaging protocol",
    homepage = "https://github.com/ibm/stomp",
    license = "Apache-2.0",
    build_cmd = """
# Build the library
make -j$(nproc)
""",
    install_cmd = """
# Install library
mkdir -p "$DESTDIR/usr/lib"
cp -a lib*.so* "$DESTDIR/usr/lib/" || true
cp -a lib*.a "$DESTDIR/usr/lib/" || true

# Install headers
mkdir -p "$DESTDIR/usr/include/stomp"
find . -name "*.h" -exec cp {} "$DESTDIR/usr/include/stomp/" \\;
""",
    visibility = ["PUBLIC"],
)

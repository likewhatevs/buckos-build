load("//defs:package_defs.bzl", "autotools_package")

# squid - Caching proxy for the web

autotools_package(
    name = "squid",
    version = "6.12",
    src_uri = "https://www.squid-cache.org/Versions/v6/squid-6.12.tar.xz",
    sha256 = "f3df3abb2603a513266f24a5d4699a9f0d76b9f554d1848b67f9c51cd3b3cb50",
    description = "Full-featured Web proxy cache server",
    homepage = "https://www.squid-cache.org/",
    license = "GPL-2",
    iuse = ["ssl", "ipv6", "ldap", "pam", "sasl", "snmp", "icap", "ecap"],
    use_defaults = ["ssl", "ipv6"],
    deps = [
        "//packages/linux/system/libs/security/libcap:libcap",
        "//packages/linux/dev-libs/xml/libxml2:libxml2",
        "//packages/linux/dev-libs/expat:expat",
    ],
    use_deps = {
        "ssl": ["//packages/linux/system/libs/crypto/openssl:openssl"],
        "ldap": ["//packages/linux/network/ldap/openldap:openldap"],
        "pam": ["//packages/linux/system/libs/auth/pam:pam"],
        "sasl": ["//packages/linux/system/libs/auth/cyrus-sasl:cyrus-sasl"],
    },
    configure_args = [
        "--prefix=/usr",
        "--sysconfdir=/etc/squid",
        "--localstatedir=/var",
        "--datadir=/usr/share/squid",
        "--enable-removal-policies=lru,heap",
        "--enable-storeio=ufs,aufs,diskd,rock",
        "--enable-disk-io=AIO,Blocking,DiskDaemon,DiskThreads",
        "--enable-auth",
        "--enable-auth-basic",
        "--enable-auth-digest",
        "--enable-auth-negotiate",
        "--enable-auth-ntlm",
        "--enable-log-daemon-helpers",
        "--enable-url-rewrite-helpers",
        "--with-default-user=squid",
        "--with-logdir=/var/log/squid",
    ],
    use_configure = {
        "ssl": "--with-openssl",
        "-ssl": "--without-openssl",
        "ipv6": "--enable-ipv6",
        "-ipv6": "--disable-ipv6",
        "ldap": "--enable-auth-basic=LDAP",
        "pam": "--enable-auth-basic=PAM",
        "sasl": "--enable-auth-basic=SASL",
        "snmp": "--enable-snmp",
        "-snmp": "--disable-snmp",
        "icap": "--enable-icap-client",
        "-icap": "--disable-icap-client",
        "ecap": "--enable-ecap",
        "-ecap": "--disable-ecap",
    },
    visibility = ["PUBLIC"],
)

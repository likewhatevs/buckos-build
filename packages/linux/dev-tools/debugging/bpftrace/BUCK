load("@root//defs:package_defs.bzl", "cmake_package")

# bpftrace - High-level tracing language for Linux eBPF

cmake_package(
    name = "bpftrace",
    version = "0.20.4",
    iuse = ["pcap", "systemd"],
    use_cmake = {
        "-pcap": "-DENABLE_PCAP=OFF",
        "-systemd": "-DENABLE_SYSTEMD=OFF",
        "pcap": "-DENABLE_PCAP=ON",
        "systemd": "-DENABLE_SYSTEMD=ON",
    },
    src_uri = "https://github.com/iovisor/bpftrace/archive/refs/tags/v0.20.4.tar.gz",
    sha256 = "7182c59db82dd4eac69fc74d6eb43656e2b45795df0a89840ae0456966d985da",
    description = "High-level tracing language for Linux enhanced BPF (eBPF)",
    homepage = "https://github.com/iovisor/bpftrace",
    license = "Apache-2.0",
    deps = [
        "system//libs/bpf:libbpf",
        "dev-libs//llvm:llvm",
        "system//libs/elfutils:libelf",
        "core//zlib:zlib",
    ],
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_TESTING=OFF",
    ],
    visibility = ["PUBLIC"],
)

load("//defs:package_defs.bzl", "download_source", "autotools_package")

# aflplusplus-4 - American Fuzzy Lop plus plus (AFL++)
# A security-oriented fuzzer that employs genetic algorithms
download_source(
    name = "aflplusplus-4-src",
    src_uri = "https://github.com/AFLplusplus/AFLplusplus/archive/refs/tags/v4.21c.tar.gz",
    sha256 = "11f7c77d37cff6e7f65ac7cc55bab7901e0c6208e845a38764394d04ed567b30",
)

autotools_package(
    name = "aflplusplus-4",
    source = ":aflplusplus-4-src",
    version = "4.21c",
    description = "American Fuzzy Lop plus plus - A security-oriented fuzzer",
    homepage = "https://github.com/AFLplusplus/AFLplusplus",
    license = "Apache-2.0",
    # AFL++ uses GNUmakefile directly, skip configure
    src_configure = """
# No configure needed for AFL++
true
""",
    src_compile = """
make -j$(nproc) \
    PREFIX=/usr \
    BIN_PATH=/usr/bin \
    HELPER_PATH=/usr/lib/afl \
    DOC_PATH=/usr/share/doc/afl \
    MISC_PATH=/usr/share/afl \
    MAN_PATH=/usr/share/man/man8
""",
    src_install = """
make install \
    DESTDIR="$DESTDIR" \
    PREFIX=/usr \
    BIN_PATH=/usr/bin \
    HELPER_PATH=/usr/lib/afl \
    DOC_PATH=/usr/share/doc/afl \
    MISC_PATH=/usr/share/afl \
    MAN_PATH=/usr/share/man/man8
""",
    deps = [
    ],
    visibility = ["PUBLIC"],
)

load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "google-java-format",
    version = "1.23.0",
    url = "https://github.com/google/google-java-format/archive/refs/tags/v1.23.0.tar.gz",
    sha256 = "85d47984a145fce834da8f22247b039a85cac6b542893949e5d3737e3707f5fe",
    description = "Java source code formatter that follows Google Java Style",
    homepage = "https://github.com/google/google-java-format",
    license = "Apache-2.0",
    install_script = """
        mkdir -p $OUT/usr/share/java
        mkdir -p $OUT/usr/bin
        find $SRCS -name "*.jar" -exec cp {} $OUT/usr/share/java/google-java-format.jar \;
        cat > $OUT/usr/bin/google-java-format << 'EOF'
#!/bin/sh
exec java --add-exports=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED \
    --add-exports=jdk.compiler/com.sun.tools.javac.code=ALL-UNNAMED \
    --add-exports=jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED \
    --add-exports=jdk.compiler/com.sun.tools.javac.parser=ALL-UNNAMED \
    --add-exports=jdk.compiler/com.sun.tools.javac.tree=ALL-UNNAMED \
    --add-exports=jdk.compiler/com.sun.tools.javac.util=ALL-UNNAMED \
    -jar /usr/share/java/google-java-format.jar "$@"
EOF
        chmod +x $OUT/usr/bin/google-java-format
    """,
)

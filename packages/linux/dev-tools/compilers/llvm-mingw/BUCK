load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "llvm-mingw",
    version = "20231017",
    url = "https://github.com/mstorsjo/llvm-mingw/archive/refs/tags/20231017.tar.gz",
    sha256 = "e387c704c866a36423c20e3d71d8774d19f8c27da4d35baa5e906122feec2488",
    install_script = """
        mkdir -p "$OUT/opt/llvm-mingw"
        cp -r "$SRCS"/* "$OUT/opt/llvm-mingw/"

        # Create symlinks in /usr/bin for common tools
        mkdir -p "$OUT/usr/bin"
        for bin in clang clang++ lld llvm-ar llvm-nm llvm-objcopy llvm-objdump llvm-ranlib llvm-strip; do
            if [ -f "$OUT/opt/llvm-mingw/bin/$bin" ]; then
                ln -sf "/opt/llvm-mingw/bin/$bin" "$OUT/usr/bin/mingw-$bin"
            fi
        done
    """,
    visibility = ["PUBLIC"],
)

load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "flamegraph",
    version = "1.0",
    url = "https://github.com/brendangregg/FlameGraph/archive/refs/tags/v1.0.tar.gz",
    sha256 = "c5ba824228a4f7781336477015cb3b2d8178ffd86bccd5f51864ed52a5ad6675",
    description = "Stack trace visualizer for performance profiling",
    homepage = "https://github.com/brendangregg/FlameGraph",
    license = "CDDL",
    install_script = """
cd "$SRCS"
mkdir -p "$OUT/usr/bin"
mkdir -p "$OUT/usr/share/flamegraph"

# Install main flamegraph script
install -m 755 flamegraph.pl "$OUT/usr/bin/flamegraph.pl"

# Install stackcollapse scripts
for script in stackcollapse*.pl stackcollapse*.awk; do
    if [ -f "$script" ]; then
        install -m 755 "$script" "$OUT/usr/bin/"
    fi
done

# Install other utility scripts
for script in difffolded.pl files.pl jmaps; do
    if [ -f "$script" ]; then
        install -m 755 "$script" "$OUT/usr/bin/"
    fi
done
""",
)

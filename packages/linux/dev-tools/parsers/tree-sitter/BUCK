load("@root//defs:package_defs.bzl", "make_package")

# Tree-sitter - Parser generator tool and incremental parsing library

make_package(
    name = "tree-sitter",
    version = "0.25.8",
    src_uri = "https://github.com/tree-sitter/tree-sitter/archive/refs/tags/v0.25.8.tar.gz",
    sha256 = "178b575244d967f4920a4642408dc4edf6de96948d37d7f06e5b78acee9c0b4e",
    description = "An incremental parsing system for programming tools",
    homepage = "https://tree-sitter.github.io/tree-sitter/",
    license = "MIT",
    deps = [],
    # tree-sitter Makefile has an issue with 'rcs' command - use make with AR override
    src_compile = """
# Fix Makefile issue where it calls 'rcs' directly instead of 'ar rcs'
# We need to create a wrapper script for rcs that calls ar rcs instead
cat > rcs << 'EOF'
#!/bin/bash
exec ar rcs "$@"
EOF
chmod +x rcs
export PATH="$PWD:$PATH"
make PREFIX=${PREFIX}
""",
    src_install = """
make install PREFIX=${PREFIX} DESTDIR="$DESTDIR"
""",
    visibility = ["PUBLIC"],
)

load("//defs:package_defs.bzl", "go_package")

go_package(
    name = "mcap-cli",
    version = "0.0.57",
    src_uri = "https://github.com/foxglove/mcap/archive/refs/tags/releases/mcap-cli/v0.0.57.tar.gz",
    sha256 = "00bfa671eeb44a3abdfb543cdb6faa7d13900fb8f174497c1f6bf3416e4023af",
    bins = ["mcap"],
    # Build from the cli/mcap package within the go subdirectory
    packages = ["./cli/mcap"],
    src_prepare = """
# This is a Go workspace with source in go/ subdirectory
# Move everything from go/ to root and set up for build
if [ -d go ]; then
    mv go/* . 2>/dev/null || true
    rmdir go 2>/dev/null || true
fi

# Clean up non-go files
rm -rf .git cpp python rust swift typescript website
""",
)

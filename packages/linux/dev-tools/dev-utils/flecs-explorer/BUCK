load("@root//defs:package_defs.bzl", "cmake_package")

cmake_package(
    name = "flecs-explorer",
    version = "0.0.0_git20250112",
    src_uri = "https://github.com/flecs-hub/explorer/archive/b97d6adf8ecf464a2ce3323ba0959a0c99eda838.tar.gz",
    sha256 = "48aca391d88d71fc29e6d1ab3e9fc6566fd408fd5e0b6d80b94cc5054e070927",
    description = "Web-based UI dashboard for monitoring flecs ECS applications",
    homepage = "https://github.com/flecs-hub/explorer",
    license = "MIT",
    deps = [],
    pre_configure = """
# Create CMakeLists.txt for the bake-based project
cat > CMakeLists.txt << 'EOF'
cmake_minimum_required(VERSION 3.10)
project(flecs_explorer C)

set(CMAKE_C_STANDARD 99)

add_executable(flecs_explorer
    deps/flecs.c
    src/main.c
)

target_include_directories(flecs_explorer PRIVATE
    ${CMAKE_SOURCE_DIR}/include
    ${CMAKE_SOURCE_DIR}/deps
)

target_compile_definitions(flecs_explorer PRIVATE
    FLECS_SOFT_ASSERT
    FLECS_KEEP_ASSERT
)

target_link_libraries(flecs_explorer PRIVATE pthread rt m)

install(TARGETS flecs_explorer RUNTIME DESTINATION bin)

# Install web assets
install(DIRECTORY etc/ DESTINATION share/flecs-explorer)
EOF
""",
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
    ],
    visibility = ["PUBLIC"],
)

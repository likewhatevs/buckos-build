load("//defs:package.bzl", "package")

package(
    build_rule = "autotools",
    name = "automake",
    version = "1.16.5",
    url = "https://mirror.buckos.org/a/automake-1.16.5.tar.xz",
    sha256 = "f01d58cd6d9d77fbdca9eb4bbd5ead1988228fdb73d6f7a201f5f8d6b118b469",
    description = "Tool for generating GNU Standards-compliant Makefiles",
    homepage = "https://www.gnu.org/software/automake/",
    license = "GPL-2.0+",
    pre_configure_cmds = [
        # Prevent make from trying to regenerate aclocal.m4 — the tarball
        # ships with pre-generated files but the Makefile has a dependency
        # on aclocal-1.16 which is what we are building.
        "touch aclocal.m4 configure Makefile.in */Makefile.in */*/Makefile.in 2>/dev/null || true",
    ],
    pre_build_cmds = [
        # Stub the doc/help2man script — it tries to run the versioned
        # binaries (aclocal-1.16, automake-1.16) that we are building.
        "printf '#!/bin/sh\\nfor arg; do case \"$arg\" in --output=*) f=\"${arg#--output=}\"; echo \".TH A 1\" > \"$f\"; exit 0;; esac; done\\nexit 0\\n' > doc/help2man && chmod +x doc/help2man",
    ],
    deps = [
        "//packages/linux/dev-tools/build-systems/autoconf:autoconf",
    ],
    visibility = ["PUBLIC"],
)

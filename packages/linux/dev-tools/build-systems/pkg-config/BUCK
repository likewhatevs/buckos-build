load("//defs:package.bzl", "package")

package(
    build_rule = "autotools",
    name = "pkg-config",
    version = "0.29.2",
    url = "https://pkgconfig.freedesktop.org/releases/pkg-config-0.29.2.tar.gz",
    sha256 = "6fc69c01688c9458a57eb9a1664c9aba372ccda420a02bf4429fe610e7e7d591",
    description = "Helper tool used when compiling applications and libraries",
    homepage = "https://www.freedesktop.org/wiki/Software/pkg-config/",
    license = "GPL-2+",

    configure_args = [
        "--with-internal-glib",
    ],
    use_configure = {
        "host-tool": ("--enable-host-tool", "--disable-host-tool"),
    },

    # Force C17 to avoid C23 bool keyword conflict in bundled glib
    # Cross-compilation cache values for internal glib (avoids running test programs)
    env = {
        "CFLAGS": "-std=gnu17 -O2",
        "glib_cv_stack_grows": "no",
        "glib_cv_uscore": "no",
        "ac_cv_func_posix_getpwuid_r": "yes",
        "ac_cv_func_posix_getgrgid_r": "yes",
    },

)

load("//defs:package_defs.bzl", "download_source", "ebuild_package")

# =============================================================================
# slibtool - A strong libtool implementation, written in C
# =============================================================================
# A faster, simpler libtool alternative. Drop-in replacement that can
# significantly speed up builds that use libtool.

download_source(
    name = "slibtool-src",
    src_uri = "https://mirror.buckos.org/s/slibtool-0.7.4.tar.xz",
    sha256 = "FIXME",
)

ebuild_package(
    name = "slibtool",
    source = ":slibtool-src",
    version = "0.7.4",
    category = "dev-tools/build-systems",
    description = "A strong libtool implementation, written in C",
    homepage = "https://git.foss21.org/slibtool",
    license = "MIT",

    # slibtool uses a custom configure script (not autoconf)
    src_configure = """
./configure \\
    --compiler="${CC:-gcc}" \\
    --host="${CHOST:-$(gcc -dumpmachine)}" \\
    --prefix=/usr \\
    --libdir=/usr/lib64
""",

    src_compile = """
make -j$(nproc)
""",

    src_install = """
make DESTDIR="$DESTDIR" install
""",

    bdepend = [
        "//packages/linux/dev-tools/build-systems/m4:m4",
    ],
    depend = [],
    visibility = ["PUBLIC"],
)

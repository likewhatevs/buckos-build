load("//defs:package_defs.bzl", "download_source", "binary_package")

# AWS Lambda RIE is a single binary file, not an archive
download_source(
    name = "aws-lambda-rie-src",
    src_uri = "https://github.com/aws/aws-lambda-runtime-interface-emulator/releases/download/v1.27/aws-lambda-rie-x86_64",
    sha256 = "b8c5c8a6aef19029b37aa9e61ecf509a5ff8c25f03b6cd0c5b96e60d9a2ef728",
    signature_required = False,
    extract = False,
)

binary_package(
    name = "aws-lambda-rie",
    srcs = [":aws-lambda-rie-src"],
    version = "1.27",
    description = "AWS Lambda Runtime Interface Emulator",
    homepage = "https://github.com/aws/aws-lambda-runtime-interface-emulator",
    license = "Apache-2.0",
    install_script = """
        mkdir -p "$OUT/usr/bin"
        # Find the downloaded binary (might be in various locations)
        BINARY=$(find "$SRCS" -type f | head -1)
        if [ -z "$BINARY" ]; then
            echo "Error: Could not find binary in $SRCS"
            exit 1
        fi
        install -m 755 "$BINARY" "$OUT/usr/bin/aws-lambda-rie"
    """,
    visibility = ["PUBLIC"],
)

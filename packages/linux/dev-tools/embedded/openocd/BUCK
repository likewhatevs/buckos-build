load("@root//defs:package_defs.bzl", "autotools_package")

autotools_package(
    name = "openocd",
    version = "0.12.0",
    iuse = [
        "capstone",
        "cmsis-dap",
        "dummy",
        "ftdi",
        "gpiod",
        "jlink",
        "parport",
        "usb",
        "verbose-io",
    ],
    use_configure = {
        "-capstone": "--disable-capstone",
        "-cmsis-dap": "--disable-cmsis-dap",
        "-dummy": "--disable-dummy",
        "-ftdi": "--disable-ftdi",
        "-gpiod": "--disable-gpiod",
        "-jlink": "--disable-jlink",
        "-parport": "--disable-parport",
        "-usb": "--disable-usb",
        "-verbose-io": "--disable-verbose-io",
        "capstone": "--enable-capstone",
        "cmsis-dap": "--enable-cmsis-dap",
        "dummy": "--enable-dummy",
        "ftdi": "--enable-ftdi",
        "gpiod": "--enable-gpiod",
        "jlink": "--enable-jlink",
        "parport": "--enable-parport",
        "usb": "--enable-usb",
        "verbose-io": "--enable-verbose-io",
    },
    src_uri = "https://downloads.sourceforge.net/project/openocd/openocd/0.12.0/openocd-0.12.0.tar.gz",
    sha256 = "bb367fd19ab96a65ee5b269b60326d9f36bca1c64d9865cc36985d3651aba563",
    description = "Open On-Chip Debugger - JTAG/SWD debugger for embedded systems",
    homepage = "https://openocd.org/",
    license = "GPL-2.0",
    configure_args = [
        "--prefix=/usr",
        "--disable-werror",
    ],
    deps = [
        "system//libs/libusb:libusb",
        "system//libs/libftdi:libftdi",
    ],
    visibility = ["PUBLIC"],
)

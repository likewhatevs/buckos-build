load("//defs:package.bzl", "package")

package(
    build_rule = "cmake",
    name = "rocksdb",
    version = "9.1.1",
    use_configure = {
        "jemalloc": ("-DENABLE_JEMALLOC=ON", "-DENABLE_JEMALLOC=OFF"),
        "numa": ("-DENABLE_NUMA=ON", "-DENABLE_NUMA=OFF"),
        "static-libs": ("-DBUILD_STATIC_LIBS=ON", "-DBUILD_STATIC_LIBS=OFF"),
        "tbb": ("-DENABLE_TBB=ON", "-DENABLE_TBB=OFF"),
    },
    url = "https://github.com/facebook/rocksdb/archive/refs/tags/v9.1.1.tar.gz",
    sha256 = "54ca90dd782a988cd3ebc3e0e9ba9b4efd563d7eb78c5e690c2403f1b7d4a87a",
    description = "Persistent key-value store for fast storage environments",
    homepage = "https://rocksdb.org/",
    license = "GPL-2.0 OR Apache-2.0",
    configure_args = [
        "-DWITH_TESTS=OFF",
        "-DWITH_BENCHMARK_TOOLS=OFF",
        "-DWITH_TOOLS=OFF",
        "-DWITH_GFLAGS=ON",
        "-DROCKSDB_BUILD_SHARED=ON",
        "-DFAIL_ON_WARNINGS=OFF",
    ],
    deps = [
        "//packages/linux/system/libs/compression/snappy:snappy",
        "//packages/linux/system/libs/compression/lz4:lz4",
        "//packages/linux/system/libs/compression/zstd:zstd",
        "//packages/linux/core/zlib:zlib",
        "//packages/linux/dev-libs/google/gflags:gflags",
    ],
)

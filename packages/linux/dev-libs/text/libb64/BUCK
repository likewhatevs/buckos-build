load("//defs:package_defs.bzl", "autotools_package")

autotools_package(
    name = "libb64",
    version = "2.0.0.1",
    src_uri = "https://github.com/libb64/libb64/archive/refs/tags/v2.0.0.1.tar.gz",
    sha256 = "ce8e578a953a591bd4a6f157eec310b9a4c2e6f10ade2fdda6ae6bafaf798b98",
    signature_required = False,
    description = "Base64 encoding/decoding library in C",
    homepage = "https://github.com/libb64/libb64",
    license = "CC0-1.0",
    src_configure = "true",
    src_compile = """
cd src
# Build object files
make -j$(nproc) CFLAGS="-O3 -fPIC -Wno-implicit-fallthrough -I../include" cencode.o cdecode.o
# Create static library manually (Makefile uses 'rv' which doesn't exist)
ar rcs libb64.a cencode.o cdecode.o
""",
    src_install = """
mkdir -p "$DESTDIR/usr/lib"
mkdir -p "$DESTDIR/usr/include/b64"
cp src/libb64.a "$DESTDIR/usr/lib/"
cp include/b64/*.h "$DESTDIR/usr/include/b64/"
""",
    visibility = ["PUBLIC"],
)

load("//defs:package.bzl", "package")

package(
    build_rule = "meson",
    name = "glib",
    version = "2.80.0",
    # use_meson for meson option mapping (not use_configure which is for autotools)
    use_configure = {
        "debug": ("-Dglib_debug=enabled", "-Dglib_debug=disabled"),
        "elf": ("-Dlibelf=enabled", "-Dlibelf=disabled"),
        "introspection": ("-Dintrospection=enabled", "-Dintrospection=disabled"),
        "selinux": ("-Dselinux=enabled", "-Dselinux=disabled"),
        "static-libs": ("-Ddefault_library=both", "-Ddefault_library=shared"),
        "sysprof": ("-Dsysprof=enabled", "-Dsysprof=disabled"),
        "systemtap": ("-Dsystemtap=true", "-Dsystemtap=false"),
        "xattr": ("-Dxattr=true", "-Dxattr=false"),
    },
    url = "https://download.gnome.org/sources/glib/2.80/glib-2.80.0.tar.xz",
    sha256 = "8228a92f92a412160b139ae68b6345bd28f24434a7b5af150ebe21ff587a561d",
    description = "Low-level core library for GNOME projects",
    homepage = "https://wiki.gnome.org/Projects/GLib",
    license = "LGPL-2.1+",
    configure_args = [
        "-Dgtk_doc=false",
        "-Dtests=false",
        "-Ddtrace=false",
        "-Dlibmount=disabled",  # Requires util-linux libmount
    ],
    # Custom install that makes .pc files relocatable using ${pcfiledir}
    # This allows packages that depend on glib to find tools like glib-mkenums
    deps = [
        "//packages/linux/system/libs/utility/libffi:libffi",
                "//packages/linux/core/zlib:zlib",
                "//packages/linux/system/libs/utility/pcre2:pcre2",
                "//packages/linux/dev-libs/python/packaging:packaging"
    ],
    visibility = ["PUBLIC"],
)

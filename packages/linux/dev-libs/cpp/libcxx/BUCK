load("@root//defs:package_defs.bzl", "cmake_package")

LIBCXX_VERSION = "18.1.8"

cmake_package(
    name = "libcxx",
    version = LIBCXX_VERSION,
    src_uri = "https://github.com/llvm/llvm-project/releases/download/llvmorg-{}/llvm-project-{}.src.tar.xz".format(LIBCXX_VERSION, LIBCXX_VERSION),
    sha256 = "0b58557a6d32ceee97c8d533a59b9212d87e0fc4d2833924eb6c611247db2f2a",
    description = "LLVM libc++ C++ Standard Library",
    homepage = "https://libcxx.llvm.org/",
    license = "Apache-2.0 WITH LLVM-exception",
    src_configure = """
mkdir -p "$S/build"
cmake -G Ninja -S "$S/runtimes" -B "$S/build" \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_BUILD_TYPE=Release \
    -DLLVM_ENABLE_RUNTIMES="libcxx;libcxxabi;libunwind" \
    -DLIBCXX_ENABLE_SHARED=ON \
    -DLIBCXX_ENABLE_STATIC=ON \
    -DLIBCXX_ENABLE_FILESYSTEM=ON \
    -DLIBCXX_INCLUDE_TESTS=OFF \
    -DLIBCXX_INCLUDE_BENCHMARKS=OFF \
    -DLIBCXXABI_ENABLE_SHARED=ON \
    -DLIBCXXABI_ENABLE_STATIC=ON \
    -DLIBCXXABI_USE_LLVM_UNWINDER=ON \
    -DLIBUNWIND_ENABLE_SHARED=ON \
    -DLIBUNWIND_ENABLE_STATIC=ON
""",
    cmake_args = [],
    deps = [
        "//packages/linux/core/llvm:llvm",
    ],
    visibility = ["PUBLIC"],
)

load("//defs:package.bzl", "package")

# Cap'n Proto - Insanely fast data interchange format

package(
    build_rule = "cmake",
    name = "capnproto",
    version = "1.0.2",
    url = "https://github.com/capnproto/capnproto/archive/refs/tags/v1.0.2.tar.gz",
    sha256 = "3cfd0ed58080d78b3a3381305489f2175cdaf1ef1cb55425d8fc8246a76bdff3",
    description = "Insanely fast data interchange format and RPC system",
    homepage = "https://capnproto.org/",
    license = "MIT",
    deps = [
        "//packages/linux/core/zlib:zlib",
    ],
    use_deps = {
        "tls": "//packages/linux/system/libs/crypto/openssl:openssl",
    },
    configure_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DBUILD_TESTING=OFF",
    ],
    use_configure = {
        "ssl": ("-DENABLE_SSL=ON", "-DENABLE_SSL=OFF"),
        "tls": ("-DWITH_OPENSSL=ON", "-DWITH_OPENSSL=OFF"),
        "zlib": ("-DENABLE_ZLIB=ON", "-DENABLE_ZLIB=OFF"),
    },
)

load("//defs:package_defs.bzl", "cmake_package")

cmake_package(
    name = "glm",
    version = "0.9.9.8",
    iuse = ["cpu_flags_x86_ssse3"],
    use_cmake = {
        "-cpu_flags_x86_ssse3": "-DENABLE_CPU_FLAGS_X86_SSSE3=OFF",
        "cpu_flags_x86_ssse3": "-DENABLE_CPU_FLAGS_X86_SSSE3=ON",
    },
    src_uri = "https://github.com/g-truc/glm/archive/refs/tags/0.9.9.8.tar.gz",
    sha256 = "7d508ab72cb5d43227a3711420f06ff99b0a0cb63ee2f93631b162bfe1fe9592",
    deps = [],
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DGLM_TEST_ENABLE=OFF",
    ],
    # glm is header-only; manually install headers
    src_install = """
mkdir -p "${DESTDIR}/${EPREFIX:-/usr}/include"
cp -r glm "${DESTDIR}/${EPREFIX:-/usr}/include/"
# Create pkg-config file
mkdir -p "${DESTDIR}/${EPREFIX:-/usr}/${LIBDIR:-lib64}/pkgconfig"
cat > "${DESTDIR}/${EPREFIX:-/usr}/${LIBDIR:-lib64}/pkgconfig/glm.pc" << 'EOF'
prefix=/usr
includedir=${prefix}/include

Name: GLM
Description: OpenGL Mathematics
Version: 0.9.9.8
Cflags: -I${includedir}
EOF
""",
    visibility = ["PUBLIC"],
)

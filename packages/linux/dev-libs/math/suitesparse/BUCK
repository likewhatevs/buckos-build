load("//defs:package_defs.bzl", "cmake_package")

cmake_package(
    name = "suitesparse",
    version = "7.6.0",
    iuse = [
        "cuda",
        "lapack",
        "partition",
        "tbb",
    ],
    use_cmake = {
        "-cuda": "-DWITH_CUDA=OFF",
        "-lapack": "-DENABLE_LAPACK=OFF",
        "-partition": "-DENABLE_PARTITION=OFF",
        "-tbb": "-DENABLE_TBB=OFF",
        "cuda": "-DWITH_CUDA=ON",
        "lapack": "-DENABLE_LAPACK=ON",
        "partition": "-DENABLE_PARTITION=ON",
        "tbb": "-DENABLE_TBB=ON",
    },
    src_uri = "https://github.com/DrTimothyAldenDavis/SuiteSparse/archive/refs/tags/v7.6.0.tar.gz",
    sha256 = "19cbeb9964ebe439413dd66d82ace1f904adc5f25d8a823c1b48c34bd0d29ea5",
    description = "Suite of sparse matrix algorithms (AMD, CHOLMOD, UMFPACK, SPQR, etc.)",
    homepage = "https://people.engr.tamu.edu/davis/suitesparse.html",
    license = "LGPL-2.1-or-later AND BSD-3-Clause AND Apache-2.0",
    deps = [
        "//packages/linux/dev-libs/math/lapack:lapack",
        "//packages/linux/dev-libs/math/openblas:openblas",
        "//packages/linux/dev-libs/math/metis:metis",
    ],
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DBUILD_STATIC_LIBS=OFF",
        "-DSUITESPARSE_ENABLE_PROJECTS=all",
        "-DSUITESPARSE_USE_OPENMP=ON",
        "-DSUITESPARSE_USE_CUDA=OFF",
        "-DSUITESPARSE_DEMOS=OFF",
    ],
    visibility = ["PUBLIC"],
)

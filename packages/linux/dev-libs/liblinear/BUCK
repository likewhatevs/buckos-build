load("@root//defs:package_defs.bzl", "make_package", "gen_pkgconfig")

make_package(
    name = "liblinear",
    version = "1.94",
    src_uri = "https://github.com/cjlin1/liblinear/archive/refs/tags/v194.tar.gz",
    sha256 = "cce039e66cb82c77e7e816c42f2c1808fcb8df6a1050c94999c419cd20be9f55",
    description = "A Library for Large Linear Classification",
    homepage = "https://github.com/cjlin1/liblinear",
    license = "BSD-3-Clause",

    src_compile = """
        # Build library and utilities using Makefile
        make lib
        make train predict
    """,

    src_install = """
        # Install shared library
        mkdir -p "$DESTDIR/usr/lib64"
        cp liblinear.so.5 "$DESTDIR/usr/lib64/"
        ln -sf liblinear.so.5 "$DESTDIR/usr/lib64/liblinear.so"

        # Install binaries
        mkdir -p "$DESTDIR/usr/bin"
        cp train "$DESTDIR/usr/bin/liblinear-train"
        cp predict "$DESTDIR/usr/bin/liblinear-predict"

        # Install header
        mkdir -p "$DESTDIR/usr/include"
        cp linear.h "$DESTDIR/usr/include/"
    """ + gen_pkgconfig(
        name = "liblinear",
        description = "A Library for Large Linear Classification",
        libs = "-llinear",
        destvar = "DESTDIR",
    ),

    visibility = ["PUBLIC"],
)

load("@root//defs:package_defs.bzl","make_package")

make_package(
    name = "tinycrypt",
    version = "0.2.8",
    src_uri = "https://github.com/intel/tinycrypt/archive/refs/tags/v0.2.8.tar.gz",
    sha256 = "971b603b3e7a75a703014558cd3f953381fa73e70a89e3b31c3459d563468a6c",
    description = "TinyCrypt Cryptographic Library",
    homepage = "https://github.com/intel/tinycrypt",
    license = "Apache-2.0",
    maintainers = ["buckos"],
    src_configure = """
# TinyCrypt uses a simple Makefile, not autotools
# Skip configure step
""",

    post_install = """
cd "$SRCDIR"

# Build the library
cd lib
make clean
make CC=cc CFLAGS="-O2 -Wall -fPIC" libtinycrypt.a

# Install static library
mkdir -p "$DESTDIR/usr/lib"
cp -f libtinycrypt.a "$DESTDIR/usr/lib/"

# Install headers
mkdir -p "$DESTDIR/usr/include/tinycrypt"
cp -f include/tinycrypt/*.h "$DESTDIR/usr/include/tinycrypt/"
""",

    deps = [],
    visibility = ["PUBLIC"],
)

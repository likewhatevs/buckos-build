load("//defs:package.bzl", "package")

# s2n-bignum - Assembly integer arithmetic routines for cryptographic applications
#
# All routines are written in pure machine code with separate versions for x86_64 and aarch64.
# Each function is accompanied by machine-checked formal proofs.

package(
    name = "s2n-bignum",
    build_rule = "autotools",
    skip_configure = True,
    version = "0.0.1",
    url = "https://mirror.buckos.org/s/s2n-bignum-main.tar.gz",
    sha256 = "a00cf1d6ed65c895d29a57f40d32f9c8a98cb4480092e785d7d0528518fb2f97",
    description = "Assembly integer arithmetic routines for cryptographic applications",
    homepage = "https://github.com/awslabs/s2n-bignum",
    license = "Apache-2.0",
    deps = [],

    # No configure script - just Makefiles in architecture-specific subdirectories

    # Build using the Makefile in the architecture-specific directory

    # Install headers and library
    post_install_cmds = ["""\
ARCH=$(uname -m)
if [ "$ARCH" = "x86_64" ]; then
    ARCHDIR=x86
elif [ "$ARCH" = "aarch64" ]; then
    ARCHDIR=arm
else
    echo "Unsupported architecture: $ARCH" >&2
    exit 1
fi

# Install library
install -d "${DESTDIR}/usr/lib"
install -m 644 "${ARCHDIR}/libs2nbignum.a" "${DESTDIR}/usr/lib/"

# Install headers
install -d "${DESTDIR}/usr/include"
install -m 644 include/s2n-bignum.h "${DESTDIR}/usr/include/"
install -m 644 include/s2n-bignum-c89.h "${DESTDIR}/usr/include/"
install -m 644 include/_internal_s2n_bignum.h "${DESTDIR}/usr/include/"
"""],

)

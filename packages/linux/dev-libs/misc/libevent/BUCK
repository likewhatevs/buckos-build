load("@root//defs:package_defs.bzl", "cmake_package")

# libevent - An event notification library

cmake_package(
    name = "libevent",
    version = "2.1.12",
    src_uri = "https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz",
    sha256 = "92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb",
    description = "An event notification library",
    homepage = "https://libevent.org/",
    license = "BSD-3-Clause",
    iuse = [
        "clock-gettime",
        "debug",
        "malloc-replacement",
        "mbedtls",
        "ssl",
        "static-libs",
        "threads",
        "verbose-debug",
    ],
    use_defaults = ["ssl", "threads"],
    deps = [],
    use_deps = {
        "ssl": ["//packages/linux/system/libs/crypto/openssl:openssl"],
    },
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DEVENT__DISABLE_TESTS=ON",
        "-DEVENT__DISABLE_SAMPLES=ON",
        "-DEVENT__DISABLE_BENCHMARK=ON",
    ],
    use_cmake = {
        "-clock-gettime": "-DENABLE_CLOCK_GETTIME=OFF",
        "-debug": "-DCMAKE_BUILD_TYPE=Release",
        "-malloc-replacement": "-DENABLE_MALLOC_REPLACEMENT=OFF",
        "-mbedtls": "-DENABLE_MBEDTLS=OFF",
        "-ssl": "-DEVENT__DISABLE_OPENSSL=ON",
        "-static-libs": "-DBUILD_STATIC_LIBS=OFF",
        "-threads": "-DEVENT__DISABLE_THREAD_SUPPORT=ON",
        "-verbose-debug": "-DENABLE_VERBOSE_DEBUG=OFF",
        "clock-gettime": "-DENABLE_CLOCK_GETTIME=ON",
        "debug": "-DCMAKE_BUILD_TYPE=Debug",
        "malloc-replacement": "-DENABLE_MALLOC_REPLACEMENT=ON",
        "mbedtls": "-DENABLE_MBEDTLS=ON",
        "ssl": "-DEVENT__DISABLE_OPENSSL=OFF",
        "static-libs": "-DBUILD_STATIC_LIBS=ON",
        "threads": "-DEVENT__DISABLE_THREAD_SUPPORT=OFF",
        "verbose-debug": "-DENABLE_VERBOSE_DEBUG=ON",
    },
    visibility = ["PUBLIC"],
)

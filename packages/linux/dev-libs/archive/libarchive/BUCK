load("@root//defs:package_defs.bzl", "cmake_package")

# libarchive - Multi-format archive and compression library

cmake_package(
    name = "libarchive",
    version = "3.7.2",
    src_uri = "https://github.com/libarchive/libarchive/releases/download/v3.7.2/libarchive-3.7.2.tar.gz",
    sha256 = "df404eb7222cf30b4f8f93828677890a2986b66ff8bf39dac32a804e96ddf104",
    description = "Multi-format archive and compression library",
    homepage = "https://www.libarchive.org/",
    license = "BSD-2-Clause",
    iuse = [
        "acl",
        "blake2",
        "bzip2",
        "e2fsprogs",
        "expat",
        "iconv",
        "lz4",
        "lzma",
        "lzo",
        "nettle",
        "openssl",
        "static-libs",
        "xattr",
        "xml",
        "zlib",
        "zstd",
    ],
    use_defaults = ["bzip2", "lzma", "zlib", "zstd"],
    deps = [
        "//packages/linux/dev-libs/compression/bzip2:bzip2",
        "//packages/linux/dev-libs/compression/lz4:lz4",
        "//packages/linux/dev-libs/compression/lzma:lzma",
        "//packages/linux/system/libs/compression/lzo:lzo",
        "//packages/linux/dev-libs/compression/zstd:zstd",
        "//packages/linux/core/zlib:zlib",
    ],
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DENABLE_TEST=OFF",
        "-DENABLE_TAR=ON",
        "-DENABLE_CPIO=ON",
        "-DENABLE_CAT=ON",
    ],
    use_cmake = {
        "-acl": "-DENABLE_ACL=OFF",
        "-blake2": "-DENABLE_BLAKE2=OFF",
        "-bzip2": "-DENABLE_BZip2=OFF",
        "-e2fsprogs": "-DENABLE_E2FSPROGS=OFF",
        "-expat": "-DENABLE_EXPAT=OFF",
        "-iconv": "-DENABLE_ICONV=OFF",
        "-lz4": "-DENABLE_LZ4=OFF",
        "-lzma": "-DENABLE_LZMA=OFF",
        "-lzo": "-DENABLE_LZO=OFF",
        "-nettle": "-DENABLE_NETTLE=OFF",
        "-openssl": "-DENABLE_OPENSSL=OFF",
        "-static-libs": "-DBUILD_STATIC_LIBS=OFF",
        "-xattr": "-DENABLE_XATTR=OFF",
        "-xml": "-DENABLE_LIBXML2=OFF",
        "-zlib": "-DENABLE_ZLIB=OFF",
        "-zstd": "-DENABLE_ZSTD=OFF",
        "acl": "-DENABLE_ACL=ON",
        "blake2": "-DENABLE_BLAKE2=ON",
        "bzip2": "-DENABLE_BZip2=ON",
        "e2fsprogs": "-DENABLE_E2FSPROGS=ON",
        "expat": "-DENABLE_EXPAT=ON",
        "iconv": "-DENABLE_ICONV=ON",
        "lz4": "-DENABLE_LZ4=ON",
        "lzma": "-DENABLE_LZMA=ON",
        "lzo": "-DENABLE_LZO=ON",
        "nettle": "-DENABLE_NETTLE=ON",
        "openssl": "-DENABLE_OPENSSL=ON",
        "static-libs": "-DBUILD_STATIC_LIBS=ON",
        "xattr": "-DENABLE_XATTR=ON",
        "xml": "-DENABLE_LIBXML2=ON",
        "zlib": "-DENABLE_ZLIB=ON",
        "zstd": "-DENABLE_ZSTD=ON",
    },
    visibility = ["PUBLIC"],
)

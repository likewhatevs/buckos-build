load("//defs:package.bzl", "package")

# foonathan_memory - STL compatible C++ memory allocator library
# Provides various allocator implementations including:
# - heap/malloc/new allocators
# - virtual memory allocators
# - stack-based static memory allocators
# - memory stack and iteration allocators
# - various memory pools
# - portable alloca() replacement (temporary_allocator)
#
# TODO: Update SHA256 checksum by running:
#   curl -sL "https://github.com/foonathan/memory/archive/refs/tags/v0.7-4.tar.gz" | sha256sum
# Or use the tools/update_checksums.py script:
#   ./tools/update_checksums.py packages/linux/dev-libs/allocators/foonathan_memory/BUCK

package(
    build_rule = "cmake",
    name = "foonathan_memory",
    version = "0.7.4",
    url = "https://github.com/foonathan/memory/archive/refs/tags/v0.7-4.tar.gz",
    # SHA256 checksum - needs verification (see TODO above)
    sha256 = "e6b532c78022709dcf8ae3db9cad0d687df12ec67141f688a01a1abd82ed2810",
    description = "STL compatible C++ memory allocator library providing various allocator implementations",
    homepage = "https://github.com/foonathan/memory",
    license = "Zlib",
    configure_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DFOONATHAN_MEMORY_BUILD_EXAMPLES=OFF",
        "-DFOONATHAN_MEMORY_BUILD_TESTS=OFF",
        "-DFOONATHAN_MEMORY_BUILD_TOOLS=OFF",
        # Disable debug features for release builds
        "-DFOONATHAN_MEMORY_DEBUG_ASSERT=OFF",
        "-DFOONATHAN_MEMORY_DEBUG_FILL=OFF",
        "-DFOONATHAN_MEMORY_DEBUG_FENCE=0",
        "-DFOONATHAN_MEMORY_DEBUG_LEAK_CHECK=OFF",
        "-DFOONATHAN_MEMORY_DEBUG_POINTER_CHECK=OFF",
        "-DFOONATHAN_MEMORY_DEBUG_DOUBLE_DEALLOC_CHECK=OFF",
    ],
)

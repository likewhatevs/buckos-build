load("//defs:package.bzl", "package")

# =============================================================================
# SPIRV-Headers - Machine-readable files for the SPIR-V Registry
# =============================================================================
#
# Required by spirv-tools. Provides SPIR-V headers, grammar files, and
# instruction/type definitions used for processing SPIR-V shaders.

package(
    build_rule = "cmake",
    name = "spirv-headers",
    version = "1.4.335.0",
    url = "https://github.com/KhronosGroup/SPIRV-Headers/archive/vulkan-sdk-1.4.335.0.tar.gz",
    sha256 = "1c47ca6342ebe86f57b46b8dbeb266fa655a1ca8e10d07e45370ff2d9c36312e",
    description = "Machine-readable files for the SPIR-V Registry",
    homepage = "https://github.com/KhronosGroup/SPIRV-Headers",
    license = "MIT",
    configure_args = [
        "-DSPIRV_HEADERS_ENABLE_TESTS=OFF",
        "-DSPIRV_HEADERS_ENABLE_INSTALL=ON",
    ],
    labels = ["buckos:hw:vulkan"],
    visibility = ["PUBLIC"],
)

# =============================================================================
# SPIRV-Tools - API and commands for processing SPIR-V modules
# =============================================================================
#
# Required by mesa 26.0.0 for SPIR-V shader compilation.
# Provides spirv-opt, spirv-val, spirv-link and other shader tools.

package(
    build_rule = "cmake",
    name = "spirv-tools",
    version = "1.4.335.0",
    url = "https://github.com/KhronosGroup/SPIRV-Tools/archive/vulkan-sdk-1.4.335.0.tar.gz",
    sha256 = "8b3d5637061b52675e506ffa1100740031e38bdd96b8177978acfd898a705da2",
    description = "Provides an API and commands for processing SPIR-V modules",
    homepage = "https://github.com/KhronosGroup/SPIRV-Tools",
    license = "Apache-2.0",
    configure_args = [
        "-DSPIRV_WERROR=OFF",
        "-DSPIRV_SKIP_TESTS=ON",
        "-DSPIRV_TOOLS_BUILD_STATIC=OFF",
    ],
    # SPIRV-Tools expects a source-dir-style path, not find_package()
    cmake_dep_defines = {
        "SPIRV-Headers_SOURCE_DIR": ":spirv-headers",
    },
    deps = [
        ":spirv-headers",
    ],
    labels = ["buckos:hw:vulkan"],
    visibility = ["PUBLIC"],
)

load("@root//defs:package_defs.bzl", "cmake_package")

# C-Blosc2 - A fast, compressed, persistent binary data store library for C

cmake_package(
    name = "c-blosc2",
    version = "2.17.1",
    src_uri = "https://github.com/Blosc/c-blosc2/archive/refs/tags/v2.17.1.tar.gz",
    sha256 = "53c6ed1167683502f5db69d212106e782180548ca5495745eb580e796b7f7505",
    description = "A fast, compressed, persistent binary data store library for C",
    homepage = "https://blosc.org",
    license = "BSD-3-Clause",
    iuse = ["cli", "plugins", "zlib", "zstd", "avx2", "avx512"],
    use_defaults = ["zlib", "zstd", "avx2"],
    deps = [
        "dev-libs//compression/lz4:lz4",
    ],
    use_deps = {
        "zlib": ["core//zlib:zlib"],
        "zstd": ["dev-libs//compression/zstd:zstd"],
    },
    cmake_args = [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DBUILD_SHARED_LIBS=ON",
        "-DBUILD_STATIC=OFF",
        "-DBUILD_TESTS=OFF",
        "-DBUILD_FUZZERS=OFF",
        "-DBUILD_BENCHMARKS=OFF",
        "-DBUILD_EXAMPLES=OFF",
        "-DBUILD_LITE=OFF",
        "-DPREFER_EXTERNAL_LZ4=ON",
        "-DDEACTIVATE_IPP=ON",
    ],
    use_cmake = {
        "cli": "-DBUILD_CLI=ON",
        "-cli": "-DBUILD_CLI=OFF",
        "plugins": "-DBUILD_PLUGINS=ON",
        "-plugins": "-DBUILD_PLUGINS=OFF",
        "zlib": [
            "-DDEACTIVATE_ZLIB=OFF",
            "-DPREFER_EXTERNAL_ZLIB=ON",
        ],
        "-zlib": "-DDEACTIVATE_ZLIB=ON",
        "zstd": [
            "-DDEACTIVATE_ZSTD=OFF",
            "-DPREFER_EXTERNAL_ZSTD=ON",
        ],
        "-zstd": "-DDEACTIVATE_ZSTD=ON",
        "avx2": "-DDEACTIVATE_AVX2=OFF",
        "-avx2": "-DDEACTIVATE_AVX2=ON",
        "avx512": "-DDEACTIVATE_AVX512=OFF",
        "-avx512": "-DDEACTIVATE_AVX512=ON",
    },
    visibility = ["PUBLIC"],
)

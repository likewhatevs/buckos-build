load("//defs:package.bzl", "package")

package(
    build_rule = "binary",
    name = "qat-zstd-plugin",
    version = "0.0.1",
    url = "https://github.com/intel/qat-zstd-plugin/archive/refs/tags/v0.0.1.tar.gz",
    sha256 = "c15aa561d5139d49f896315cbd38d02a51b636e448abfa58e4d3a011fe0424f2",
    description = "Intel QAT ZSTD Plugin - Hardware acceleration for ZSTD compression",
    homepage = "https://github.com/intel/qat-zstd-plugin",
    license = "BSD-3-Clause",
    install_script = """
        cd "$SRCS/src"

        # Build with INTREE flag (no external QAT SDK required, uses system qatlib)
        make CFLAGS="-DINTREE" lib

        # Install library and header
        mkdir -p "$OUT/usr/lib" "$OUT/usr/include"
        cp libqatseqprod.a "$OUT/usr/lib/"
        cp libqatseqprod.so "$OUT/usr/lib/"
        cp qatseqprod.h "$OUT/usr/include/"
    """,
    deps = [
        "//packages/linux/system/libs/compression/zstd:zstd",
    ],
)

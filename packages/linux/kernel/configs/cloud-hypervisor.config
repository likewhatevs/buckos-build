#
# BuckOS Kernel Cloud Hypervisor Guest Configuration
# Optimized for running as a Cloud Hypervisor VM guest
#

# PVH Boot Support (preferred for Cloud Hypervisor)
CONFIG_PVH=y
CONFIG_PARAVIRT=y
CONFIG_PARAVIRT_SPINLOCKS=y

# VirtIO Full Stack (essential for Cloud Hypervisor)
CONFIG_VIRTIO=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_PCI_LEGACY=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_NET=y
CONFIG_VIRTIO_CONSOLE=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_INPUT=y
CONFIG_VIRTIO_MMIO=y
CONFIG_VIRTIO_MEM=y

# VirtioFS Support (for shared filesystem boot)
CONFIG_VIRTIO_FS=y
CONFIG_FUSE_FS=y
CONFIG_DAX=y
CONFIG_DAX_DRIVER=y
CONFIG_FS_DAX=y

# Vsock Support (for host-guest communication)
CONFIG_VIRTIO_VSOCKETS=y
CONFIG_VIRTIO_VSOCKETS_COMMON=y
CONFIG_VSOCKETS=y

# Virtio GPU (optional, for graphical console)
CONFIG_DRM_VIRTIO_GPU=y

# Hardware RNG via VirtIO
CONFIG_HW_RANDOM=y
CONFIG_HW_RANDOM_VIRTIO=y

# EFI Support (for firmware boot mode)
CONFIG_EFI=y
CONFIG_EFI_STUB=y
CONFIG_EFI_VARS=y
CONFIG_EFIVAR_FS=y

# Serial Console (essential for Cloud Hypervisor)
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_EARLYCON=y

# Watchdog
CONFIG_VIRTIO_WDT=y

# ACPI Support (Cloud Hypervisor uses ACPI)
CONFIG_ACPI=y
CONFIG_ACPI_HOTPLUG_CPU=y
CONFIG_ACPI_HOTPLUG_MEMORY=y
CONFIG_ACPI_CONTAINER=y

# Memory Hotplug (for dynamic memory management)
CONFIG_MEMORY_HOTPLUG=y
CONFIG_MEMORY_HOTREMOVE=y
CONFIG_ARCH_ENABLE_MEMORY_HOTPLUG=y

# CPU Hotplug (for vCPU scaling)
CONFIG_HOTPLUG_CPU=y
CONFIG_ARCH_ENABLE_MEMORY_HOTREMOVE=y

# Disable unnecessary hardware drivers for VM guests
# These are typically not needed in Cloud Hypervisor environments
# CONFIG_DRM_I915 is not set
# CONFIG_DRM_AMDGPU is not set
# CONFIG_DRM_NOUVEAU is not set
# CONFIG_USB_STORAGE is not set
# CONFIG_SATA_AHCI is not set
# CONFIG_ATA is not set

# Enable kernel same-page merging (KSM) for memory efficiency
CONFIG_KSM=y

# Transparent hugepages for better memory performance
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_TRANSPARENT_HUGEPAGE_ALWAYS=y

# Disable legacy features not needed for Cloud Hypervisor
# CONFIG_ISA is not set
# CONFIG_MDA_CONSOLE is not set
# CONFIG_VGA_CONSOLE is not set

# Minimal framebuffer (for serial console use)
CONFIG_FB=y
CONFIG_FB_SIMPLE=y

# Trim kernel size
# CONFIG_DEBUG_INFO is not set
# CONFIG_DEBUG_KERNEL is not set

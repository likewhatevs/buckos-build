load("//defs:package_defs.bzl", "kernel_build")

# BuckOS Default Kernel
#
# This is the official BuckOS kernel package, built with a comprehensive
# configuration that supports most common hardware and use cases.
#
# Features:
# - Linux 6.17.10 Stable kernel
# - Broad hardware support (x86_64)
# - Multiple filesystems (ext4, XFS, Btrfs, NTFS, etc.)
# - Full networking stack with modern features (BBR, nftables)
# - Virtualization support (KVM host and VirtIO guest)
# - Container support (cgroups v2, namespaces)
# - Security features (AppArmor, SELinux, TPM)
#
# For custom kernel configurations, see the examples or create your own
# kernel_config with specific fragments.
#
# Available kernel versions:
# - Mainline: 6.18 (kernel//src:linux-mainline-src)
# - Stable: 6.17.10 (default, kernel//src:linux-stable-src)
# - LTS: 6.12.60 (kernel//src:linux-lts-src)

kernel_build(
    name = "buckos-kernel",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-default",
    visibility = ["PUBLIC"],
)

# Minimal kernel variant
# Smaller footprint, fewer drivers, faster boot
kernel_build(
    name = "buckos-kernel-minimal",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-minimal",
    visibility = ["PUBLIC"],
)

# Server kernel variant
# Optimized for server workloads
kernel_build(
    name = "buckos-kernel-server",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-server",
    visibility = ["PUBLIC"],
)

# VM Guest kernel
# Optimized for running inside virtual machines
kernel_build(
    name = "buckos-kernel-vm",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-vm-guest",
    visibility = ["PUBLIC"],
)

# Defconfig kernel (for development/testing)
kernel_build(
    name = "buckos-kernel-defconfig",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    visibility = ["PUBLIC"],
)

# Live CD/USB kernel
# Full graphics support (i915, amdgpu, nouveau) for desktop environments
# Optimized for live system booting and hardware detection
kernel_build(
    name = "buckos-kernel-live",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-live",
    visibility = ["PUBLIC"],
)

# Cloud Hypervisor Guest kernel
# Optimized for running inside Cloud Hypervisor VMs
# Includes: PVH boot, VirtioFS, vsock, virtio-mem, hardware RNG
# Excludes: Physical hardware drivers (GPU, USB, SATA) not needed in VMs
kernel_build(
    name = "buckos-kernel-ch",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-ch-guest",
    visibility = ["PUBLIC"],
)

# =============================================================================
# ARM64 (aarch64) Kernel Variants
# =============================================================================

# ARM64 default kernel
# General purpose ARM64 kernel with virtio and cloud support
kernel_build(
    name = "buckos-kernel-aarch64",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-aarch64-default",
    arch = "aarch64",
    cross_toolchain = "toolchains//bootstrap:cross-toolchain-aarch64",
    visibility = ["PUBLIC"],
)

# ARM64 cloud kernel
# Optimized for AWS Graviton, Azure Ampere, and other cloud ARM64 instances
kernel_build(
    name = "buckos-kernel-aarch64-cloud",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-aarch64-cloud",
    arch = "aarch64",
    cross_toolchain = "toolchains//bootstrap:cross-toolchain-aarch64",
    visibility = ["PUBLIC"],
)

# ARM64 minimal kernel
# Minimal configuration for QEMU testing
kernel_build(
    name = "buckos-kernel-aarch64-minimal",
    source = "//packages/linux/kernel/src:linux-src",
    version = "6.17.10",
    config_dep = "//packages/linux/kernel/configs:buckos-aarch64-minimal",
    arch = "aarch64",
    cross_toolchain = "toolchains//bootstrap:cross-toolchain-aarch64",
    visibility = ["PUBLIC"],
)

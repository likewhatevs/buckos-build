"""
Bootstrap toolchain instantiation and export.

Provides:
  :bootstrap-toolchain  — BuildToolchainInfo wrapping Stage 1 output
  :export               — distributable tar.zst archive (cross-compiler only)
  :seed-export          — distributable tar.zst archive (cross-compiler + host tools)
"""

load("//tc:toolchain_rules.bzl", "buckos_bootstrap_toolchain")
load("//defs/rules:toolchain_export.bzl", "toolchain_export")

buckos_bootstrap_toolchain(
    name = "bootstrap-toolchain",
    bootstrap_stage = "//tc/bootstrap/stage1:stage1",
    visibility = ["PUBLIC"],
)

# Export the Stage 1 cross-compiler (runs on host, targets buckos).
# Stage 2 produces native tools for the target system — those can't
# run on the build host and are used for rootfs content instead.
toolchain_export(
    name = "export",
    stage = "//tc/bootstrap/stage1:stage1",
    gcc_version = "14.3.0",
    glibc_version = "2.42",
    visibility = ["PUBLIC"],
)

# Seed export: Stage 1 cross-compiler + host tools.
# Used as the fallback when no prebuilt seed is configured.
# The bootstrap transition on host_tools flips the toolchain to host PATH
# tools, breaking the circular dependency automatically.
toolchain_export(
    name = "seed-export",
    stage = "//tc/bootstrap/stage1:stage1",
    host_tools = "//tc/bootstrap/host-tools:host-tools",
    gcc_version = "14.3.0",
    glibc_version = "2.42",
    visibility = ["PUBLIC"],
)
